<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<!-- Mini Cart Fragment -->
<div th:fragment="mini-cart" class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasCart" aria-labelledby="My Cart">
    <div class="offcanvas-header justify-content-center">
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div class="order-md-last">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
                <span class="text-primary">Giỏ hàng</span>
                <span class="badge bg-primary rounded-circle pt-2 cart-count-badge" id="cartCount" th:text="${@cartService.getMiniCartData().totalItems}">0</span>
            </h4>
            
            <!-- Cart Items Container -->
            <div id="cartItemsContainer" th:if="${@cartService.getMiniCartData().items.size() > 0}">
                <!-- Cart Items -->
                <div th:each="item : ${@cartService.getMiniCartData().items}" class="mini-cart-item" th:data-item-id="${item.id}">
                    <img th:src="${item.imageUrl}" th:alt="${item.tenSanPham}" class="mini-cart-item-image">
                    <div class="mini-cart-item-details">
                        <div class="mini-cart-item-name" th:text="${item.tenSanPham}"></div>
                        <div class="mini-cart-item-variant" th:text="${item.tenSize + ' / ' + item.tenMauSac}"></div>
                        <div class="mini-cart-item-price" th:text="${#numbers.formatDecimal(item.thanhTien, 0, 'COMMA', 0, 'POINT') + '₫'}"></div>
                        <div class="mini-cart-item-quantity">
                            <button class="mini-cart-quantity-btn" data-action="decrease" 
                                    th:disabled="${item.soLuong <= 1}">-</button>
                            <input type="number" class="mini-cart-quantity-input" 
                                   th:value="${item.soLuong}" th:min="1" th:max="${item.soLuongTonKho}" 
                                   th:data-original-value="${item.soLuong}">
                            <button class="mini-cart-quantity-btn" data-action="increase"
                                    th:disabled="${item.soLuong >= item.soLuongTonKho}">+</button>
                        </div>
                    </div>
                    <button class="mini-cart-item-remove" title="Xóa sản phẩm">
                        <iconify-icon icon="mdi:close" width="16"></iconify-icon>
                    </button>
                </div>
            </div>
            
            <!-- Empty Cart -->
            <div id="cartItemsContainer" th:if="${@cartService.getMiniCartData().items.size() == 0}" class="mini-cart-empty">
                <div class="mini-cart-empty-icon">
                    <iconify-icon icon="mdi:cart-outline" width="48"></iconify-icon>
                </div>
                <p>Giỏ hàng trống</p>
                <p class="text-muted">Hãy thêm sản phẩm vào giỏ hàng</p>
            </div>
            
            <!-- Cart Summary -->
            <div id="cartSummary" class="mt-3" th:if="${@cartService.getMiniCartData().items.size() > 0}">
                <div class="mini-cart-total">
                    <span class="mini-cart-total-label">Tổng tiền:</span>
                    <span class="mini-cart-total-amount" id="cartTotal" th:text="${#numbers.formatDecimal(@cartService.getMiniCartData().totalAmount, 0, 'COMMA', 0, 'POINT') + '₫'}"></span>
                </div>
                <div class="mini-cart-actions">
                    <a href="/gio-hang/hien_thi" class="mini-cart-btn mini-cart-btn-outline">Xem giỏ hàng</a>
                    <a href="/gio-hang/thanh-toan" class="mini-cart-btn mini-cart-btn-primary">Thanh toán</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cart Count Badge Fragment -->
<div th:fragment="cart-count-badge" class="badge bg-primary rounded-circle pt-2 cart-count-badge" id="cartCount" th:text="${@cartService.getMiniCartData().totalItems}">0</div>

<!-- Mobile Header Cart Count Fragment -->
<div th:fragment="mobile-cart-count" class="position-absolute translate-middle badge rounded-circle bg-primary pt-2 cart-count-badge" id="mobileHeaderCartCount" th:text="${@cartService.getMiniCartData().totalItems}">0</div>

<!-- Header Cart Count Fragment -->
<div th:fragment="header-cart-count" class="badge bg-primary rounded-circle pt-2 cart-count-badge" id="headerCartCount" th:text="${@cartService.getMiniCartData().totalItems}">0</div>

</html> 