<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{client/layout}">

<head>
    <title>Sản phẩm</title>
    <meta name="description" content="Khám phá bộ sưu tập phụ kiện thú cưng đa dạng với nhiều lựa chọn về loại thú, kích cỡ, màu sắc và thương hiệu">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            prefix: 'tw-',
            important: true,
            theme: {
                extend: {
                    width: {
                        '6': '1.5rem',
                        '6.5': '1.625rem', 
                        '8': '2rem',
                        '10': '2.5rem',
                        '15': '3.75rem', // 60px
                    },
                    minWidth: {
                        '15': '3.75rem',
                    },
                    maxWidth: {
                        '16': '4rem',
                        '20': '5rem',
                    },
                    height: {
                        '6': '1.5rem',
                        '6.5': '1.625rem', // 26px
                        '8': '2rem',
                        '10': '2.5rem',
                    },
                    colors: {
                        'primary': '#3b82f6',
                        'primary-500': '#3b82f6',
                        'light': '#ffffff',
                        'neutral': {
                            '200': '#e5e5e5',
                            '300': '#d4d4d4',
                            '400': '#a3a3a3',
                            '500': '#737373',
                            '900': '#171717',
                        }
                    },
                    leading: {
                        '3': '0.75rem',
                        '4': '1rem',
                        '4.5': '1.125rem',
                    }
                }
            }
        }
    </script>
    <script th:src="@{/client-static/product-page.js}" defer></script>
    <style>
        /* Accordion animations */
        .accordion-content {
            transition: max-height 0.3s ease-in-out;
            overflow: hidden;
        }
        
        .accordion-icon {
            transition: transform 0.3s ease;
        }
        
        .accordion-icon.rotated {
            transform: rotate(-180deg);
        }
        
        /* Better accordion styling */
        .accordion-trigger:hover .accordion-icon {
            color: #3b82f6;
        }
        
        .accordion-content {
            will-change: max-height;
        }
    </style>
</head>

<body>
    <div layout:fragment="content">
        <div class="tw-min-h-screen tw-bg-gray-50">
            <div class="tw-container tw-mx-auto tw-px-4 tw-py-6">
                <div class="tw-flex tw-gap-6">
                    <!-- Filter Sidebar -->
                    <div class="tw-w-80 tw-flex-shrink-0">
                        <div class="tw-sticky tw-top-28 tw-overflow-y-auto lg:tw-max-h-[calc(100vh-100px)] lg:tw-w-[294px] lg:tw-pr-5">
                            <!-- Header - new style -->
                            <div class="tw-flex tw-items-center tw-justify-between tw-bg-white tw-border tw-border-neutral-200 tw-rounded-xl tw-px-4 tw-py-3 tw-shadow-sm">
                                <div class="tw-flex tw-items-center tw-gap-2">
                                    <svg class="tw-w-4 tw-h-4 tw-text-neutral-600" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h18M6 8h12M9 12h6M12 16h0"/></svg>
                                    <h2 class="tw-text-sm tw-font-semibold tw-text-neutral-800">Bộ lọc</h2>
                                </div>
                                <div class="tw-flex tw-items-center tw-gap-3">
                                    <p class="tw-text-sm tw-text-neutral-500" id="filterResultCount">0 kết quả</p>
                                    <button type="button" onclick="clearAllFilters()" class="tw-text-xs tw-font-semibold tw-text-neutral-700 tw-bg-neutral-100 hover:tw-bg-neutral-200 tw-rounded-full tw-px-3 tw-py-1">Xóa tất cả</button>
                                </div>
                            </div>
                            <div class="tw-h-3"></div>

                            <div class="tw-relative tw-flex tw-flex-col tw-gap-6 tw-overflow-y-auto tw-overflow-x-hidden tw-pb-36 tw-pr-2 max-lg:tw-max-h-[calc(100vh-50px)]">
                                <div class="tw-flex tw-w-full tw-flex-col tw-gap-4 lg:tw-gap-2">

                                <!-- Kích cỡ -->
                                <div class="tw-border-b tw-border-b-neutral-200 tw-pb-4 lg:tw-border-0 lg:tw-p-0 lg:tw-pb-0">
                                    <h3 class="tw-flex">
                                        <button type="button" class="tw-group tw-flex tw-flex-1 tw-items-center tw-justify-between tw-transition-all tw-py-1.5 tw-text-sm tw-font-semibold tw-leading-4 tw-text-neutral-700 lg:tw-py-3" 
                                                onclick="toggleAccordion('size-accordion')">
                                            Kích cỡ
                                            <svg class="tw-h-4 tw-w-4 tw-shrink-0 accordion-icon" id="size-accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/>
                                            </svg>
                                        </button>
                                    </h3>
                                    <div id="size-accordion" class="accordion-content tw-text-sm">
                                        <div class="tw-py-1.5 lg:tw-pt-3">
                                            <ul class="tw-flex tw-flex-wrap tw-gap-2">
                                                <li>
                                                    <button class="tw-flex tw-w-auto tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-full tw-border tw-bg-white tw-px-3 tw-py-2 tw-text-xs tw-uppercase tw-leading-4 tw-transition-colors tw-ease-linear tw-border-neutral-300 tw-text-neutral-600 hover:tw-border-neutral-500" 
                                                            data-size-id="">Tất cả</button>
                                                </li>
                                                <li th:each="size : ${sizes}">
                                                    <button class="tw-flex tw-w-auto tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-full tw-border tw-bg-white tw-px-3 tw-py-2 tw-text-xs tw-uppercase tw-leading-4 tw-transition-colors tw-ease-linear tw-border-neutral-300 tw-text-neutral-600 hover:tw-border-neutral-500" 
                                                            th:data-size-id="${size.id}" th:text="${size.ten}"></button>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <!-- Màu sắc -->
                                <div class="tw-border-b tw-border-b-neutral-200 tw-pb-4 lg:tw-border-0 lg:tw-p-0 lg:tw-pb-0">
                                    <h3 class="tw-flex">
                                        <button type="button" class="tw-group tw-flex tw-flex-1 tw-items-center tw-justify-between tw-transition-all tw-py-1.5 tw-text-sm tw-font-semibold tw-leading-4 tw-text-neutral-700 lg:tw-py-3" 
                                                onclick="toggleAccordion('color-accordion')">
                                            Màu sắc
                                            <svg class="tw-h-4 tw-w-4 tw-shrink-0 accordion-icon" id="color-accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/>
                                            </svg>
                                        </button>
                                    </h3>
                                    <div id="color-accordion" class="accordion-content tw-text-sm">
                                        <div class="tw-py-1.5 lg:tw-pt-3">
                                            <ul class="tw-grid tw-grid-cols-4 tw-gap-3 tw-items-start">
                                                <li class="tw-flex tw-justify-center">
                                                    <button class="tw-group tw-flex tw-w-full tw-max-w-20 tw-flex-col tw-items-center tw-justify-start tw-p-1" data-color-id="">
                                                        <span class="tw-block tw-h-8 tw-w-8 tw-rounded-md tw-border-2 tw-border-gray-300 group-hover:tw-border-primary-500 tw-transition-all tw-duration-200 tw-shadow-sm" 
                                                              style="background:linear-gradient(226.4deg, rgba(255, 26, 1, 1) 28.9%, rgba(254, 155, 1, 1) 33%, rgba(255, 241, 0, 1) 48.6%, rgba(34, 218, 1, 1) 65.3%, rgba(0, 141, 254, 1) 80.6%, rgba(113, 63, 254, 1) 100.1%); box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></span>
                                                        <p class="tw-mt-1 tw-text-[11px] tw-leading-3 tw-text-neutral-600 group-hover:tw-text-primary-500 tw-text-center">Phối màu</p>
                                                    </button>
                                                </li>
                                                <li th:each="mauSac : ${mauSacs}" class="tw-flex tw-justify-center">
                                                    <button class="tw-group tw-flex tw-w-full tw-max-w-20 tw-flex-col tw-items-center tw-justify-start tw-p-1" 
                                                            th:data-color-id="${mauSac.id}"
                                                            th:data-color-name="${mauSac.ten}">
                                                        <span class="tw-block tw-h-8 tw-w-8 tw-rounded-md tw-border-2 group-hover:tw-border-primary-500 tw-transition-all tw-duration-200 tw-shadow-sm tw-cursor-pointer" 
                                                              th:style="'background: ' + ${mauSac.maMau} + '; border-color: ' + (${mauSac.maMau == '#FFFFFF' or mauSac.maMau == '#FFF8DC' or mauSac.maMau == '#F5F5DC'} ? '#D1D5DB' : ${mauSac.maMau}) + '; box-shadow: 0 2px 4px rgba(0,0,0,0.1);'"></span>
                                                        <p class="tw-mt-1 tw-text-[11px] tw-leading-3 tw-text-neutral-600 group-hover:tw-text-primary-500 tw-text-center tw-font-medium" th:text="${mauSac.ten}"></p>
                                                    </button>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <!-- Danh mục -->
                                <div class="tw-border-b tw-border-b-neutral-200 tw-pb-4 lg:tw-border-0 lg:tw-p-0 lg:tw-pb-0">
                                    <h3 class="tw-flex">
                                        <button type="button" class="tw-group tw-flex tw-flex-1 tw-items-center tw-justify-between tw-transition-all tw-py-1.5 tw-text-sm tw-font-semibold tw-leading-4 tw-text-neutral-700 lg:tw-py-3" 
                                                onclick="toggleAccordion('danhmuc-accordion')">
                                            Danh mục
                                            <svg class="tw-h-4 tw-w-4 tw-shrink-0 accordion-icon" id="danhmuc-accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/>
                                            </svg>
                                        </button>
                                    </h3>
                                    <div id="danhmuc-accordion" class="accordion-content tw-text-sm">
                                        <div class="tw-py-1.5 lg:tw-pt-3">
                                            <div class="tw-flex tw-flex-wrap tw-gap-2">
                                                <button type="button" role="checkbox" class="tw-inline-flex tw-items-center tw-gap-2 tw-rounded-full tw-border tw-border-neutral-400 tw-bg-white tw-text-xs tw-text-neutral-700 tw-px-3 tw-py-1.5" data-danh-muc-id="">
                                                    Tất cả
                                                </button>
                                                                                                        <span th:each="danhMuc : ${danhMucs}">
                                                            <button type="button" role="checkbox" class="tw-inline-flex tw-items-center tw-gap-2 tw-rounded-full tw-border tw-border-neutral-400 tw-bg-white tw-text-xs tw-text-neutral-700 tw-px-3 tw-py-1.5" th:data-danh-muc-id="${danhMuc.id}">
                                                                <span th:text="${danhMuc.ten}"></span>
                                                            </button>
                                                            <label class="tw-hidden" th:text="${danhMuc.ten}"></label>
                                                        </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Thương hiệu -->
                                <div class="tw-border-b tw-border-b-neutral-200 tw-pb-4 lg:tw-border-0 lg:tw-p-0 lg:tw-pb-0">
                                    <h3 class="tw-flex">
                                        <button type="button" class="tw-group tw-flex tw-flex-1 tw-items-center tw-justify-between tw-transition-all tw-py-1.5 tw-text-sm tw-font-semibold tw-leading-4 tw-text-neutral-700 lg:tw-py-3" 
                                                onclick="toggleAccordion('thuonghieu-accordion')">
                                            Thương hiệu
                                            <svg class="tw-h-4 tw-w-4 tw-shrink-0 accordion-icon" id="thuonghieu-accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/>
                                            </svg>
                                        </button>
                                    </h3>
                                    <div id="thuonghieu-accordion" class="accordion-content tw-text-sm">
                                        <div class="tw-py-1.5 lg:tw-pt-3">
                                            <div class="tw-flex tw-flex-wrap tw-gap-2">
                                                <button type="button" role="checkbox" class="tw-inline-flex tw-items-center tw-gap-2 tw-rounded-full tw-border tw-border-neutral-400 tw-bg-white tw-text-xs tw-text-neutral-700 tw-px-3 tw-py-1.5" data-thuong-hieu-id="">
                                                    Tất cả
                                                </button>
                                                                                                        <span th:each="thuongHieu : ${thuongHieus}">
                                                            <button type="button" role="checkbox" class="tw-inline-flex tw-items-center tw-gap-2 tw-rounded-full tw-border tw-border-neutral-400 tw-bg-white tw-text-xs tw-text-neutral-700 tw-px-3 tw-py-1.5" th:data-thuong-hieu-id="${thuongHieu.id}">
                                                                <span th:text="${thuongHieu.ten}"></span>
                                                            </button>
                                                            <label class="tw-hidden" th:text="${thuongHieu.ten}"></label>
                                                        </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Giá -->
                                <div class="tw-border-b tw-border-b-neutral-200 tw-pb-4 lg:tw-border-0 lg:tw-p-0 lg:tw-pb-0">
                                    <h3 class="tw-flex">
                                        <button type="button" class="tw-group tw-flex tw-flex-1 tw-items-center tw-justify-between tw-transition-all tw-py-1.5 tw-text-sm tw-font-semibold tw-leading-4 tw-text-neutral-700 lg:tw-py-3" 
                                                onclick="toggleAccordion('price-accordion')">
                                            Giá
                                            <svg class="tw-h-4 tw-w-4 tw-shrink-0 accordion-icon" id="price-accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/>
                                            </svg>
                                        </button>
                                    </h3>
                                    <div id="price-accordion" class="accordion-content tw-text-sm">
                                        <div class="tw-py-1.5 lg:tw-pt-3">
                                            <div class="tw-grid tw-gap-2">
                                                <div class="tw-flex tw-flex-wrap tw-gap-2">
                                                    <button type="button" role="checkbox" class="tw-rounded-full tw-border tw-border-neutral-400 tw-bg-white tw-text-xs tw-text-neutral-700 tw-px-3 tw-py-1.5" data-price-range="0-200000">0 - 200.000đ</button>
                                                    <button type="button" role="checkbox" class="tw-rounded-full tw-border tw-border-neutral-400 tw-bg-white tw-text-xs tw-text-neutral-700 tw-px-3 tw-py-1.5" data-price-range="200000-300000">200.000đ - 300.000đ</button>
                                                    <button type="button" role="checkbox" class="tw-rounded-full tw-border tw-border-neutral-400 tw-bg-white tw-text-xs tw-text-neutral-700 tw-px-3 tw-py-1.5" data-price-range="300000-500000">300.000đ - 500.000đ</button>
                                                    <button type="button" role="checkbox" class="tw-rounded-full tw-border tw-border-neutral-400 tw-bg-white tw-text-xs tw-text-neutral-700 tw-px-3 tw-py-1.5" data-price-range="500000+">>500.000đ</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Product Content -->
                    <div class="tw-flex-1">
                        <!-- Active Filters Display -->
                        <div id="activeFilters" class="tw-mb-6 tw-bg-white tw-rounded-lg tw-shadow-sm tw-border tw-border-gray-200 tw-p-6 tw-hidden">
                            <h5 class="tw-text-lg tw-font-semibold tw-text-gray-900 tw-mb-4 tw-flex tw-items-center">
                                <svg class="tw-w-5 tw-h-5 tw-mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Bộ lọc đang áp dụng:
                            </h5>
                            <div id="filterTags" class="tw-flex tw-flex-wrap tw-gap-2">
                                <!-- Filter tags will be dynamically added here -->
                            </div>
                        </div>

                        <!-- Sort Options -->
                        <div class="tw-mb-6 tw-flex tw-items-center tw-justify-between tw-bg-white tw-rounded-lg tw-shadow-sm tw-border tw-border-gray-200 tw-p-4">
                            <span class="tw-text-gray-600">Sắp xếp theo</span>
                            <select class="tw-border tw-border-gray-300 tw-rounded-lg tw-px-4 tw-py-2 tw-text-sm tw-focus:ring-2 tw-focus:ring-blue-500 tw-focus:border-blue-500">
                                <option>Bán chạy</option>
                                <option>Giá tăng dần</option>
                                <option>Giá giảm dần</option>
                                <option>Mới nhất</option>
                            </select>
                        </div>

                        <!-- Search Input (hidden but needed for JavaScript) -->
                        <input type="text" id="searchInput" class="tw-hidden" placeholder="Tìm kiếm sản phẩm...">

                        <!-- Price Range Slider (hidden but needed for JavaScript) -->
                        <div class="tw-hidden">
                            <input type="range" id="priceRange" min="0" max="10000000" step="100000" value="10000000">
                            <span id="maxPrice">10,000,000đ</span>
                        </div>

                        <!-- Loading Spinner -->
                        <div id="loadingSpinner" class="tw-hidden tw-justify-center tw-items-center tw-py-12">
                            <div class="tw-animate-spin tw-rounded-full tw-h-12 tw-w-12 tw-border-b-2 tw-border-blue-500"></div>
                        </div>

                        <!-- Product Grid -->
                        <div id="productGrid" class="tw-grid tw-grid-cols-1 md:tw-grid-cols-2 lg:tw-grid-cols-3 xl:tw-grid-cols-3 tw-gap-6" th:fragment="productGrid">
                            <div th:if="${#lists.isEmpty(danhSachSanPham)}" class="tw-col-span-full"></div>
                            <div th:each="sp : ${danhSachSanPham}" class="tw-bg-white tw-rounded-xl tw-border tw-border-neutral-200 tw-overflow-hidden tw-group tw-shadow-[0_1px_0_rgba(0,0,0,0.04)] hover:tw-shadow-[0_12px_30px_-12px_rgba(0,0,0,0.3)] tw-transition-all tw-duration-300 hover:tw-translate-y-[-2px] tw-cursor-pointer">
                                <a th:href="@{'/san-pham/chi-tiet/' + ${sp.id}}" class="tw-block tw-relative tw-aspect-[4/5] tw-bg-neutral-50 tw-overflow-hidden">
                                    <img th:each="img : ${sp.hinhAnhs}" th:if="${img.loaiAnh == 0}" th:src="@{${img.url}}" th:alt="${sp.ten}" class="tw-w-full tw-h-full tw-object-cover tw-transition-transform tw-duration-500 group-hover:tw-scale-105"/>

                                    <!-- Ribbon Discount -->
                                    <div th:if="${sp.dotGiamGia != null}" class="tw-absolute tw-top-3 tw-left-0 tw-origin-left tw--rotate-6">
                                        <div class="tw-inline-flex tw-items-center tw-gap-1 tw-bg-red-500 tw-text-white tw-text-[10px] tw-font-bold tw-tracking-wide tw-px-2.5 tw-py-1 tw-rounded-r-md tw-shadow-md">
                                            <svg class="tw-w-3 tw-h-3" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5z"/></svg>
                                            <span th:text="${sp.dotGiamGia.giaTriDotGiamGia} + '% OFF'"></span>
                                        </div>
                                    </div>

                                    <!-- Wishlist -->
                                    <button type="button" class="tw-absolute tw-bottom-3 tw-right-3 tw-bg-white tw-rounded-full tw-w-9 tw-h-9 tw-flex tw-items-center tw-justify-center tw-shadow-md tw-transition-all tw-duration-300 hover:tw-shadow-lg tw-border tw-border-neutral-200" th:classappend="${likedMap != null and likedMap.containsKey(sp.id) and likedMap.get(sp.id)} ? ' tw-text-red-500 tw-bg-red-50' : ' tw-text-neutral-600'" th:attr="data-wishlist-id=${sp.id}" th:onclick="|addToWishlist(${sp.id})|">
                                        <svg class="tw-w-5 tw-h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                                    </button>
                                </a>

                                <div class="tw-px-4 tw-pt-4 tw-pb-4">
                                    <!-- Brand as chip -->
                                    <div class="tw-mb-2" th:if="${sp.thuongHieu != null}">
                                        <span class="tw-inline-flex tw-items-center tw-gap-1 tw-text-[11px] tw-font-medium tw-text-neutral-600 tw-bg-neutral-100 tw-rounded-full tw-px-2.5 tw-py-1">
                                            <svg class="tw-w-3 tw-h-3 tw-text-neutral-500" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                                            <span th:text="${sp.thuongHieu.ten}"></span>
                                        </span>
                                    </div>

                                    <!-- Name -->
                                    <h3 class="tw-text-[13px] tw-font-semibold tw-text-neutral-900 tw-leading-snug tw-line-clamp-2 tw-min-h-[2.2em]">
                                        <span th:text="${sp.ten}"></span>
                                    </h3>

                                    <!-- Price -->
                                    <div class="tw-mt-2 tw-mb-3">
                                        <div class="tw-flex tw-items-end tw-gap-2">
                                            <div class="tw-text-[18px] tw-font-extrabold tw-text-neutral-900" th:text="${#numbers.formatDecimal((giaBanMinMap != null and giaBanMinMap.containsKey(sp.id)) ? giaBanMinMap.get(sp.id) : 0, 0, 'COMMA', 0, 'POINT')} + 'đ'"></div>
                                            <div class="tw-text-[12px] tw-text-neutral-400 tw-line-through" th:if="${giaGocMinVariantMap != null and giaGocMinVariantMap.containsKey(sp.id) and giaBanMinMap != null and giaBanMinMap.containsKey(sp.id) and giaGocMinVariantMap.get(sp.id) > giaBanMinMap.get(sp.id)}" th:text="${#numbers.formatDecimal(giaGocMinVariantMap.get(sp.id), 0, 'COMMA', 0, 'POINT')} + 'đ'"></div>
                                        </div>
                                        <div class="tw-mt-1" th:if="${tenDotGiamGiaMap != null and tenDotGiamGiaMap.containsKey(sp.id)}">
                                            <span class="tw-text-[11px] tw-text-red-600 tw-bg-red-50 tw-font-semibold tw-rounded tw-px-2 tw-py-0.5" th:text="${tenDotGiamGiaMap.get(sp.id)}"></span>
                                        </div>
                                    </div>

                                    <!-- Rating & Stock -->
                                    <div class="tw-flex tw-items-center tw-justify-between">
                                        <div class="tw-flex tw-items-center tw-gap-1.5">
                                            <div class="tw-flex tw-text-amber-400">
                                                <span th:with="rating=${(avgRatingMap != null and avgRatingMap.containsKey(sp.id)) ? avgRatingMap.get(sp.id) : 0}, full=${T(java.lang.Math).floor(rating)}, half=${(rating - T(java.lang.Math).floor(rating)) >= 0.5}" th:remove="tag">
                                                    <svg th:each="i : ${#numbers.sequence(1,5)}" class="tw-h-4 tw-w-4" viewBox="0 0 20 20" fill="currentColor" th:classappend="${i <= full} ? 'tw-text-amber-400' : (${half} and ${i == full + 1} ? 'tw-text-amber-300' : 'tw-text-gray-200')">
                                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                                    </svg>
                                                </span>
                                            </div>
                                            <span class="tw-text-[11px] tw-text-neutral-500 tw-font-medium" th:text="${#lists.size(sp.danhGias)} + ' đánh giá'"></span>
                                        </div>
                                        <div class="tw-flex tw-items-center tw-gap-1" th:with="qty=${(totalQuantityMap != null and totalQuantityMap.containsKey(sp.id)) ? totalQuantityMap.get(sp.id) : 0}">
                                            <span class="tw-inline-block tw-w-2 tw-h-2 tw-rounded-full" th:classappend="${qty > 0} ? ' tw-bg-green-500' : ' tw-bg-red-500'"></span>
                                            <span class="tw-text-[11px] tw-font-semibold" th:classappend="${qty > 0} ? ' tw-text-green-600' : ' tw-text-red-600'" th:text="${qty > 0} ? 'Còn hàng' : 'Hết hàng'"></span>
                                        </div>
                                    </div>

                                    <!-- CTA -->
                                    <div class="tw-mt-3">
                                        <a th:href="@{'/san-pham/chi-tiet/' + ${sp.id}}" class="tw-inline-flex tw-items-center tw-justify-center tw-w-full tw-rounded-lg tw-bg-neutral-100 hover:tw-bg-neutral-200 tw-text-[12px] tw-font-semibold tw-text-neutral-700 tw-px-3 tw-py-2 tw-transition-colors">
                                            <span>Xem chi tiết</span>
                                            <svg class="tw-w-4 tw-h-4 tw-ml-1" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- No Products Message -->
                        <div id="noProducts" class="tw-text-center tw-py-16 tw-hidden">
                            <svg class="tw-mx-auto tw-h-16 tw-w-16 tw-text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                            </svg>
                            <h3 class="tw-mt-4 tw-text-lg tw-font-medium tw-text-gray-900">Không tìm thấy sản phẩm</h3>
                            <p class="tw-mt-2 tw-text-gray-600">Hãy thử điều chỉnh bộ lọc của bạn</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Accordion functionality
        function toggleAccordion(accordionId) {
            const accordion = document.getElementById(accordionId);
            const icon = document.getElementById(accordionId + '-icon');
            
            if (accordion.classList.contains('hidden')) {
                accordion.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                accordion.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Initialize some accordions as open
        document.addEventListener('DOMContentLoaded', function() {
            toggleAccordion('size-accordion');
            toggleAccordion('color-accordion');
            // Trigger initial load to populate product grid
            if (typeof applyFilters === 'function') {
                applyFilters();
            }
        });
    </script>
</body>
</html>