<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{client/layout}">

<head>
    <title>Sản phẩm</title>
    <meta name="description" content="Khám phá bộ sưu tập phụ kiện thú cưng đa dạng với nhiều lựa chọn về loại thú, kích cỡ, màu sắc và thương hiệu">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            prefix: 'tw-',
            important: true,
            theme: {
                extend: {
                    width: {
                        '6': '1.5rem',
                        '6.5': '1.625rem', 
                        '8': '2rem',
                        '10': '2.5rem',
                        '15': '3.75rem', // 60px
                    },
                    minWidth: {
                        '15': '3.75rem',
                    },
                    maxWidth: {
                        '16': '4rem',
                        '20': '5rem',
                    },
                    height: {
                        '6': '1.5rem',
                        '6.5': '1.625rem', // 26px
                        '8': '2rem',
                        '10': '2.5rem',
                    },
                    colors: {
                        'primary': '#3b82f6',
                        'primary-500': '#3b82f6',
                        'light': '#ffffff',
                        'neutral': {
                            '200': '#e5e5e5',
                            '300': '#d4d4d4',
                            '400': '#a3a3a3',
                            '500': '#737373',
                            '900': '#171717',
                        }
                    },
                    leading: {
                        '3': '0.75rem',
                        '4': '1rem',
                        '4.5': '1.125rem',
                    }
                }
            }
        }
    </script>
    <script th:src="@{/client-static/product-page.js}" defer></script>
    <style>
        /* Accordion animations */
        .accordion-content {
            transition: max-height 0.3s ease-in-out;
            overflow: hidden;
        }
        
        .accordion-icon {
            transition: transform 0.3s ease;
        }
        
        .accordion-icon.rotated {
            transform: rotate(-180deg);
        }
        
        /* Better accordion styling */
        .accordion-trigger:hover .accordion-icon {
            color: #3b82f6;
        }
        
        .accordion-content {
            will-change: max-height;
        }
    </style>
</head>

<body>
    <div layout:fragment="content">
        <div class="tw-min-h-screen tw-bg-gray-50">
            <div class="tw-container tw-mx-auto tw-px-4 tw-py-6">
                <div class="tw-flex tw-gap-6">
                    <!-- Filter Sidebar -->
                    <div class="tw-w-80 tw-flex-shrink-0">
                        <div class="tw-sticky tw-top-28 tw-overflow-y-auto lg:tw-max-h-[calc(100vh-100px)] lg:tw-w-[294px] lg:tw-pr-5">
                            <!-- Header -->
                            <div class="tw-flex tw-items-center tw-justify-between">
                                <h2 class="tw-text-base tw-font-medium tw-leading-6 tw-text-neutral-900">Bộ lọc</h2>
                                <p class="tw-text-base tw-leading-4 tw-text-neutral-500" id="filterResultCount">8 kết quả</p>
                            </div>
                            <div class="tw-relative tw-h-[1px] tw-w-full tw-bg-neutral-900/20 tw-my-3 tw-mb-0"></div>

                            <div class="tw-relative tw-flex tw-flex-col tw-gap-6 tw-overflow-y-auto tw-overflow-x-hidden tw-pb-36 tw-pr-2 max-lg:tw-max-h-[calc(100vh-50px)]">
                                <div class="tw-flex tw-w-full tw-flex-col tw-gap-4 lg:tw-gap-2">

                                <!-- Kích cỡ -->
                                <div class="tw-border-b tw-border-b-neutral-200 tw-pb-4 lg:tw-border-0 lg:tw-p-0 lg:tw-pb-0">
                                    <h3 class="tw-flex">
                                        <button type="button" class="tw-group tw-flex tw-flex-1 tw-items-center tw-justify-between tw-transition-all tw-hover:underline tw-py-1.5 tw-text-sm tw-font-medium tw-leading-4 tw-text-neutral-400 lg:tw-py-3" 
                                                onclick="toggleAccordion('size-accordion')">
                                            Kích cỡ
                                            <svg class="tw-h-4 tw-w-4 tw-shrink-0 accordion-icon" id="size-accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/>
                                            </svg>
                                        </button>
                                    </h3>
                                    <div id="size-accordion" class="accordion-content tw-text-sm">
                                        <div class="tw-py-1.5 lg:tw-pt-3">
                                            <ul class="tw-flex tw-flex-wrap tw-gap-2">
                                                <li>
                                                    <button class="tw-flex tw-w-14 tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-md tw-border tw-bg-light tw-px-3 tw-py-2 tw-text-sm tw-uppercase tw-leading-4 tw-transition-colors tw-ease-linear tw-border-neutral-300 tw-text-neutral-500 lg:tw-hover:border-primary lg:tw-hover:bg-primary lg:tw-hover:text-light" 
                                                            data-size-id="">Tất cả</button>
                                                </li>
                                                <li th:each="size : ${sizes}">
                                                    <button class="tw-flex tw-w-14 tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-md tw-border tw-bg-light tw-px-3 tw-py-2 tw-text-sm tw-uppercase tw-leading-4 tw-transition-colors tw-ease-linear tw-border-neutral-300 tw-text-neutral-500 lg:tw-hover:border-primary lg:tw-hover:bg-primary lg:tw-hover:text-light" 
                                                            th:data-size-id="${size.id}" th:text="${size.ten}"></button>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <!-- Màu sắc -->
                                <div class="tw-border-b tw-border-b-neutral-200 tw-pb-4 lg:tw-border-0 lg:tw-p-0 lg:tw-pb-0">
                                    <h3 class="tw-flex">
                                        <button type="button" class="tw-group tw-flex tw-flex-1 tw-items-center tw-justify-between tw-transition-all tw-hover:underline tw-py-1.5 tw-text-sm tw-font-medium tw-leading-4 tw-text-neutral-400 lg:tw-py-3" 
                                                onclick="toggleAccordion('color-accordion')">
                                            Màu sắc
                                            <svg class="tw-h-4 tw-w-4 tw-shrink-0 accordion-icon" id="color-accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/>
                                            </svg>
                                        </button>
                                    </h3>
                                    <div id="color-accordion" class="accordion-content tw-text-sm">
                                        <div class="tw-py-1.5 lg:tw-pt-3">
                                            <ul class="tw-grid tw-grid-cols-3 tw-gap-3 tw-items-start">
                                                <li class="tw-flex tw-justify-center">
                                                    <button class="tw-group tw-flex tw-w-full tw-max-w-16 tw-flex-col tw-items-center tw-justify-start tw-p-1" data-color-id="">
                                                        <span class="tw-block tw-h-8 tw-w-8 tw-rounded-full tw-border-2 tw-border-gray-300 group-hover:tw-border-primary-500 tw-transition-all tw-duration-200 tw-shadow-sm" 
                                                              style="background:linear-gradient(226.4deg, rgba(255, 26, 1, 1) 28.9%, rgba(254, 155, 1, 1) 33%, rgba(255, 241, 0, 1) 48.6%, rgba(34, 218, 1, 1) 65.3%, rgba(0, 141, 254, 1) 80.6%, rgba(113, 63, 254, 1) 100.1%); box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></span>
                                                        <p class="tw-mt-1 tw-text-xs tw-leading-3 tw-text-neutral-500 group-hover:tw-text-primary-500 tw-text-center">Phối màu</p>
                                                    </button>
                                                </li>
                                                <li th:each="mauSac : ${mauSacs}" class="tw-flex tw-justify-center">
                                                    <button class="tw-group tw-flex tw-w-full tw-max-w-16 tw-flex-col tw-items-center tw-justify-start tw-p-1" 
                                                            th:data-color-id="${mauSac.id}"
                                                            th:data-color-name="${mauSac.ten}">
                                                        <span class="tw-block tw-h-8 tw-w-8 tw-rounded-full tw-border-2 group-hover:tw-border-primary-500 tw-transition-all tw-duration-200 tw-shadow-sm tw-cursor-pointer" 
                                                              th:style="'background: ' + ${mauSac.maMau} + '; border-color: ' + (${mauSac.maMau == '#FFFFFF' or mauSac.maMau == '#FFF8DC' or mauSac.maMau == '#F5F5DC'} ? '#D1D5DB' : ${mauSac.maMau}) + '; box-shadow: 0 2px 4px rgba(0,0,0,0.1);'"></span>
                                                        <p class="tw-mt-1 tw-text-xs tw-leading-3 tw-text-neutral-500 group-hover:tw-text-primary-500 tw-text-center tw-font-medium" th:text="${mauSac.ten}"></p>
                                                    </button>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                            <!-- Loại thú -->
                            <div class="tw-border-b tw-border-b-neutral-200 tw-pb-4 lg:tw-border-0 lg:tw-p-0 lg:tw-pb-0">
                                <h3 class="tw-flex">
                                    <button type="button" class="tw-group tw-flex tw-flex-1 tw-items-center tw-justify-between tw-transition-all tw-hover:underline tw-py-1.5 tw-text-sm tw-font-medium tw-leading-4 tw-text-neutral-400 lg:tw-py-3" 
                                            onclick="toggleAccordion('loaithu-accordion')">
                                        Loại thú
                                        <svg class="tw-h-4 tw-w-4 tw-shrink-0 accordion-icon" id="loaithu-accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/>
                                        </svg>
                                    </button>
                                </h3>
                                <div id="loaithu-accordion" class="accordion-content tw-text-sm">
                                    <div class="tw-py-1.5 lg:tw-pt-3">
                                        <div class="tw-grid tw-gap-2">
                                            <div class="tw-flex tw-items-center tw-space-x-2">
                                                <button type="button" role="radio" class="tw-aspect-square tw-rounded-full tw-border tw-border-neutral-500 tw-text-primary tw-h-5 tw-w-5" data-loai-thu-id="">
                                                </button>
                                                <label class="tw-text-neutral-500 tw-text-base tw-cursor-pointer">Tất cả</label>
                                            </div>
                                            <div th:each="loaiThu : ${loaiThus}" class="tw-flex tw-items-center tw-space-x-2">
                                                <button type="button" role="radio" class="tw-aspect-square tw-rounded-full tw-border tw-border-neutral-500 tw-text-primary tw-h-5 tw-w-5" th:data-loai-thu-id="${loaiThu.id}">
                                                </button>
                                                <label class="tw-text-neutral-500 tw-text-base tw-cursor-pointer" th:text="${loaiThu.ten}"></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                                <!-- Danh mục -->
                                <div class="tw-border-b tw-border-b-neutral-200 tw-pb-4 lg:tw-border-0 lg:tw-p-0 lg:tw-pb-0">
                                    <h3 class="tw-flex">
                                        <button type="button" class="tw-group tw-flex tw-flex-1 tw-items-center tw-justify-between tw-transition-all tw-hover:underline tw-py-1.5 tw-text-sm tw-font-medium tw-leading-4 tw-text-neutral-400 lg:tw-py-3" 
                                                onclick="toggleAccordion('danhmuc-accordion')">
                                            Danh mục
                                            <svg class="tw-h-4 tw-w-4 tw-shrink-0 accordion-icon" id="danhmuc-accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/>
                                            </svg>
                                        </button>
                                    </h3>
                                    <div id="danhmuc-accordion" class="accordion-content tw-text-sm">
                                        <div class="tw-py-1.5 lg:tw-pt-3">
                                            <div class="tw-grid tw-gap-2">
                                                <div class="tw-flex tw-items-center tw-space-x-2">
                                                    <button type="button" role="checkbox" class="tw-flex tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-border tw-border-neutral-500 tw-h-5 tw-w-5" data-danh-muc-id="">
                                                    </button>
                                                    <label class="tw-text-neutral-500 tw-text-base tw-cursor-pointer">Tất cả</label>
                                                </div>
                                                <div th:each="danhMuc : ${danhMucs}" class="tw-flex tw-items-center tw-space-x-2">
                                                    <button type="button" role="checkbox" class="tw-flex tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-border tw-border-neutral-500 tw-h-5 tw-w-5" th:data-danh-muc-id="${danhMuc.id}">
                                                    </button>
                                                    <label class="tw-text-neutral-500 tw-text-base tw-cursor-pointer" th:text="${danhMuc.ten}"></label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Thương hiệu -->
                                <div class="tw-border-b tw-border-b-neutral-200 tw-pb-4 lg:tw-border-0 lg:tw-p-0 lg:tw-pb-0">
                                    <h3 class="tw-flex">
                                        <button type="button" class="tw-group tw-flex tw-flex-1 tw-items-center tw-justify-between tw-transition-all tw-hover:underline tw-py-1.5 tw-text-sm tw-font-medium tw-leading-4 tw-text-neutral-400 lg:tw-py-3" 
                                                onclick="toggleAccordion('thuonghieu-accordion')">
                                            Thương hiệu
                                            <svg class="tw-h-4 tw-w-4 tw-shrink-0 accordion-icon" id="thuonghieu-accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/>
                                            </svg>
                                        </button>
                                    </h3>
                                    <div id="thuonghieu-accordion" class="accordion-content tw-text-sm">
                                        <div class="tw-py-1.5 lg:tw-pt-3">
                                            <div class="tw-grid tw-gap-2">
                                                <div class="tw-flex tw-items-center tw-space-x-2">
                                                    <button type="button" role="checkbox" class="tw-flex tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-border tw-border-neutral-500 tw-h-5 tw-w-5" data-thuong-hieu-id="">
                                                    </button>
                                                    <label class="tw-text-neutral-500 tw-text-base tw-cursor-pointer">Tất cả</label>
                                                </div>
                                                <div th:each="thuongHieu : ${thuongHieus}" class="tw-flex tw-items-center tw-space-x-2">
                                                    <button type="button" role="checkbox" class="tw-flex tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-border tw-border-neutral-500 tw-h-5 tw-w-5" th:data-thuong-hieu-id="${thuongHieu.id}">
                                                    </button>
                                                    <label class="tw-text-neutral-500 tw-text-base tw-cursor-pointer" th:text="${thuongHieu.ten}"></label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Giá -->
                                <div class="tw-border-b tw-border-b-neutral-200 tw-pb-4 lg:tw-border-0 lg:tw-p-0 lg:tw-pb-0">
                                    <h3 class="tw-flex">
                                        <button type="button" class="tw-group tw-flex tw-flex-1 tw-items-center tw-justify-between tw-transition-all tw-hover:underline tw-py-1.5 tw-text-sm tw-font-medium tw-leading-4 tw-text-neutral-400 lg:tw-py-3" 
                                                onclick="toggleAccordion('price-accordion')">
                                            Giá
                                            <svg class="tw-h-4 tw-w-4 tw-shrink-0 accordion-icon" id="price-accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/>
                                            </svg>
                                        </button>
                                    </h3>
                                    <div id="price-accordion" class="accordion-content tw-text-sm">
                                        <div class="tw-py-1.5 lg:tw-pt-3">
                                            <div class="tw-grid tw-gap-2">
                                                <div class="tw-flex tw-items-center tw-space-x-2">
                                                    <button type="button" role="checkbox" class="tw-flex tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-border tw-border-neutral-500 tw-h-5 tw-w-5" data-price-range="0-200000">
                                                    </button>
                                                    <label class="tw-text-neutral-500 tw-text-base tw-cursor-pointer">0 - 200.000đ</label>
                                                </div>
                                                <div class="tw-flex tw-items-center tw-space-x-2">
                                                    <button type="button" role="checkbox" class="tw-flex tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-border tw-border-neutral-500 tw-h-5 tw-w-5" data-price-range="200000-300000">
                                                    </button>
                                                    <label class="tw-text-neutral-500 tw-text-base tw-cursor-pointer">200.000đ - 300.000đ</label>
                                                </div>
                                                <div class="tw-flex tw-items-center tw-space-x-2">
                                                    <button type="button" role="checkbox" class="tw-flex tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-border tw-border-neutral-500 tw-h-5 tw-w-5" data-price-range="300000-500000">
                                                    </button>
                                                    <label class="tw-text-neutral-500 tw-text-base tw-cursor-pointer">300.000đ - 500.000đ</label>
                                                </div>
                                                <div class="tw-flex tw-items-center tw-space-x-2">
                                                    <button type="button" role="checkbox" class="tw-flex tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-border tw-border-neutral-500 tw-h-5 tw-w-5" data-price-range="500000+">
                                                    </button>
                                                    <label class="tw-text-neutral-500 tw-text-base tw-cursor-pointer">>500.000đ</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Product Content -->
                    <div class="tw-flex-1">
                        <!-- Active Filters Display -->
                        <div id="activeFilters" class="tw-mb-6 tw-bg-white tw-rounded-lg tw-shadow-sm tw-border tw-border-gray-200 tw-p-6 tw-hidden">
                            <h5 class="tw-text-lg tw-font-semibold tw-text-gray-900 tw-mb-4 tw-flex tw-items-center">
                                <svg class="tw-w-5 tw-h-5 tw-mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Bộ lọc đang áp dụng:
                            </h5>
                            <div id="filterTags" class="tw-flex tw-flex-wrap tw-gap-2">
                                <!-- Filter tags will be dynamically added here -->
                            </div>
                        </div>

                        <!-- Sort Options -->
                        <div class="tw-mb-6 tw-flex tw-items-center tw-justify-between tw-bg-white tw-rounded-lg tw-shadow-sm tw-border tw-border-gray-200 tw-p-4">
                            <span class="tw-text-gray-600">Sắp xếp theo</span>
                            <select class="tw-border tw-border-gray-300 tw-rounded-lg tw-px-4 tw-py-2 tw-text-sm tw-focus:ring-2 tw-focus:ring-blue-500 tw-focus:border-blue-500">
                                <option>Bán chạy</option>
                                <option>Giá tăng dần</option>
                                <option>Giá giảm dần</option>
                                <option>Mới nhất</option>
                            </select>
                        </div>

                        <!-- Loading Spinner -->
                        <div id="loadingSpinner" class="tw-hidden tw-justify-center tw-items-center tw-py-12">
                            <div class="tw-animate-spin tw-rounded-full tw-h-12 tw-w-12 tw-border-b-2 tw-border-blue-500"></div>
                        </div>

                        <!-- Product Grid -->
                        <div id="productGrid" class="tw-grid tw-grid-cols-1 md:tw-grid-cols-2 lg:tw-grid-cols-3 xl:tw-grid-cols-4 tw-gap-6" th:fragment="productGrid">
                            <div th:if="${#lists.isEmpty(danhSachSanPham)}" class="tw-col-span-full"></div>
                            <div th:each="sp : ${danhSachSanPham}" class="tw-bg-white tw-rounded-2xl tw-shadow-sm tw-border tw-border-gray-100 tw-overflow-hidden tw-group tw-transition-all tw-duration-300 hover:tw-shadow-lg hover:tw-shadow-gray-200/50 hover:tw-scale-[1.02] tw-cursor-pointer">
                                <a th:href="@{'/san-pham/chi-tiet/' + ${sp.id}}" class="tw-block tw-relative tw-aspect-square tw-bg-gradient-to-br tw-from-gray-50 tw-to-gray-100 tw-overflow-hidden">
                                    <img th:each="img : ${sp.hinhAnhs}" th:if="${img.loaiAnh == 0}" th:src="@{${img.url}}" th:alt="${sp.ten}" class="tw-w-full tw-h-full tw-object-cover tw-transition-all tw-duration-500 group-hover:tw-scale-110 group-hover:tw-rotate-1"/>
                                    
                                    <!-- Discount Badge with Apple-style design -->
                                    <div th:if="${sp.dotGiamGia != null}" class="tw-absolute tw-top-3 tw-left-3 tw-bg-gradient-to-r tw-from-red-500 tw-to-pink-500 tw-text-white tw-text-xs tw-font-semibold tw-rounded-full tw-px-3 tw-py-1.5 tw-shadow-lg tw-shadow-red-500/25 tw-backdrop-blur-sm tw-border tw-border-white/20">
                                        <span th:text="${sp.dotGiamGia.giaTriDotGiamGia} + '% OFF'">-20% OFF</span>
                                    </div>
                                    
                                    <!-- Wishlist Button with Apple-style design -->
                                    <button type="button" class="tw-absolute tw-top-3 tw-right-3 tw-bg-white/80 tw-backdrop-blur-md tw-rounded-full tw-w-10 tw-h-10 tw-flex tw-items-center tw-justify-center tw-shadow-lg tw-shadow-black/10 tw-transition-all tw-duration-300 hover:tw-bg-white hover:tw-shadow-xl hover:tw-shadow-black/20 tw-border tw-border-white/30" th:classappend="${likedMap != null and likedMap.containsKey(sp.id) and likedMap.get(sp.id)} ? ' tw-text-red-500 tw-bg-red-50/90' : ' tw-text-gray-600'" th:attr="data-wishlist-id=${sp.id}" th:onclick="|addToWishlist(${sp.id})|">
                                        <svg class="tw-w-5 tw-h-5 tw-transition-transform tw-duration-200 group-hover:tw-scale-110" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                        </svg>
                                    </button>
                                    
                                    <!-- Quick View Overlay -->
                                    <div class="tw-absolute tw-inset-0 tw-bg-black/0 tw-transition-all tw-duration-300 group-hover:tw-bg-black/5 tw-flex tw-items-center tw-justify-center">
                                        <div class="tw-bg-white/90 tw-backdrop-blur-sm tw-rounded-full tw-p-3 tw-opacity-0 tw-transition-all tw-duration-300 group-hover:tw-opacity-100 tw-transform tw-scale-75 group-hover:tw-scale-100">
                                            <svg class="tw-w-6 tw-h-6 tw-text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                            </svg>
                                        </div>
                                    </div>
                                </a>
                                
                                <div class="tw-p-5">
                                    <!-- Brand with icon -->
                                    <div class="tw-flex tw-items-center tw-gap-2 tw-mb-2" th:if="${sp.thuongHieu != null}">
                                        <svg class="tw-w-3 tw-h-3 tw-text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                                        </svg>
                                        <span class="tw-text-xs tw-text-gray-500 tw-font-medium" th:text="${sp.thuongHieu.ten}"></span>
                                    </div>
                                    
                                    <!-- Product Name -->
                                    <h3 class="tw-text-sm tw-font-semibold tw-text-gray-900 tw-line-clamp-2 tw-leading-tight tw-mb-3" th:text="${sp.ten}"></h3>
                                    
                                    <!-- Price Section -->
                                    <div class="tw-mb-3">
                                        <div class="tw-flex tw-items-baseline tw-gap-2 tw-mb-1">
                                            <div class="tw-text-lg tw-font-bold tw-text-gray-900" th:text="${#numbers.formatDecimal((giaSauGiamMinMap != null and giaSauGiamMinMap.containsKey(sp.id)) ? giaSauGiamMinMap.get(sp.id) : 0, 0, 'COMMA', 0, 'POINT')} + 'đ'"></div>
                                            <div class="tw-text-sm tw-text-gray-400 tw-line-through" th:if="${giaGocMinVariantMap != null and giaGocMinVariantMap.containsKey(sp.id) and giaGocMinVariantMap.get(sp.id) > 0}" th:text="${#numbers.formatDecimal(giaGocMinVariantMap.get(sp.id), 0, 'COMMA', 0, 'POINT')} + 'đ'"></div>
                                        </div>
                                        <div class="tw-text-xs tw-text-red-500 tw-font-semibold tw-bg-red-50 tw-rounded-full tw-px-2 tw-py-1 tw-inline-block" th:if="${tenDotGiamGiaMap != null and tenDotGiamGiaMap.containsKey(sp.id)}" th:text="${tenDotGiamGiaMap.get(sp.id)}"></div>
                                    </div>
                                    
                                    <!-- Rating Section -->
                                    <div class="tw-flex tw-items-center tw-justify-between tw-mb-3">
                                        <div class="tw-flex tw-items-center tw-gap-2">
                                            <div class="tw-flex tw-text-amber-400">
                                                <span th:with="rating=${(avgRatingMap != null and avgRatingMap.containsKey(sp.id)) ? avgRatingMap.get(sp.id) : 0}, full=${T(java.lang.Math).floor(rating)}, half=${(rating - T(java.lang.Math).floor(rating)) >= 0.5}" th:remove="tag">
                                                    <svg th:each="i : ${#numbers.sequence(1,5)}" class="tw-h-4 tw-w-4 tw-transition-colors tw-duration-200" viewBox="0 0 20 20" fill="currentColor" th:classappend="${i <= full} ? 'tw-text-amber-400' : (${half} and ${i == full + 1} ? 'tw-text-amber-300' : 'tw-text-gray-200')">
                                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                                    </svg>
                                                </span>
                                            </div>
                                            <span class="tw-text-xs tw-text-gray-500 tw-font-medium" th:text="${#lists.size(sp.danhGias)} + ' đánh giá'"></span>
                                        </div>
                                        
                                        <!-- Stock Status with icon -->
                                        <div class="tw-flex tw-items-center tw-gap-1" th:with="qty=${(totalQuantityMap != null and totalQuantityMap.containsKey(sp.id)) ? totalQuantityMap.get(sp.id) : 0}">
                                            <svg th:if="${qty > 0}" class="tw-w-3 tw-h-3 tw-text-green-500" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                            </svg>
                                            <svg th:unless="${qty > 0}" class="tw-w-3 tw-h-3 tw-text-red-500" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                            </svg>
                                            <span class="tw-text-xs tw-font-semibold" th:classappend="${qty > 0} ? ' tw-text-green-600' : ' tw-text-red-600'" th:text="${qty > 0} ? 'Còn hàng' : 'Hết hàng'"></span>
                                        </div>
                                    </div>
                                    
                                    <!-- View Details Button -->
                                    <div class="tw-bg-gray-50 tw-rounded-xl tw-p-3 tw-text-center tw-transition-all tw-duration-300 group-hover:tw-bg-gray-100">
                                        <span class="tw-text-sm tw-font-semibold tw-text-gray-700 tw-flex tw-items-center tw-justify-center tw-gap-2">
                                            <span>Xem chi tiết</span>
                                            <svg class="tw-w-4 tw-h-4 tw-transition-transform tw-duration-300 group-hover:tw-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- No Products Message -->
                        <div id="noProducts" class="tw-text-center tw-py-16 tw-hidden">
                            <svg class="tw-mx-auto tw-h-16 tw-w-16 tw-text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                            </svg>
                            <h3 class="tw-mt-4 tw-text-lg tw-font-medium tw-text-gray-900">Không tìm thấy sản phẩm</h3>
                            <p class="tw-mt-2 tw-text-gray-600">Hãy thử điều chỉnh bộ lọc của bạn</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Accordion functionality
        function toggleAccordion(accordionId) {
            const accordion = document.getElementById(accordionId);
            const icon = document.getElementById(accordionId + '-icon');
            
            if (accordion.classList.contains('hidden')) {
                accordion.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                accordion.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Initialize some accordions as open
        document.addEventListener('DOMContentLoaded', function() {
            toggleAccordion('size-accordion');
            toggleAccordion('color-accordion');
            // Trigger initial load to populate product grid
            if (typeof applyFilters === 'function') {
                applyFilters();
            }
        });
    </script>
</body>
</html>